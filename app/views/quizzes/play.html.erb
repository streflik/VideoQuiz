<!-- zakladki -->

<ul id="tabs">
  <li class="first current">ZOBACZ<br />FILM DO KOŃCA</li>
  <li class="second">ODPOWIEDZ<br />NA PYTANIE</li>
  <li class="third">WYGRAJ<br /><%= @quiz.reward_short %></li>
</ul>

<div class="clear"></div>

<!-- -------------------------------------------------------------------- video -->

<div class="pane" id="video">

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>

  <div class="player">
    <div id="ytapiplayer">
      Potrzebujesz Flash Player i włączonej obsługi Java Script.
    </div>
  </div>

  <div class="fb-like">
    <a name="fb_share" type="button_count" share_url="<%= @quiz.landing_page %>">Udostępnij</a> 
  </div>

  <% unless @quiz.name == "CyfrowaSzkoła.pl" %>
    <h3>ZOSTAŁO TYLKO <span><%= @quiz.codes.size  %></span> KUPONÓW</h3>
  <% end %>

</div>

<!-- -------------------------------------------------------------------- pytanie -->

<div class="pane" id="question">

  <div id="question_content">

  </div>


  <%= render 'problem' %>

</div>


<!-- -------------------------------------------------------------------- wygrana -->

<div class="pane" id="coupon">

  <div id="reward_content">

  <!-- -------------------------------------------------------------------- przegrana -->

  <div id="looser" style="display:none;">
    <div class="looser_content">
      <h2>Zła odpowiedź :-(<br/>Spróbuj ponownie jutro.</h2>
     </div>
     <%= render 'problem' %>
  </div>

  </div>

</div>

<!-- -------------------------------------------------------------------- wykorzystana szansa -->

<div class="pane" id="fail">
  <div class="fail_content">
    <h2>Wykorzystano już dzisiejszą szansę.<br />Spróbuj ponownie jutro.</h2>
  </div>
  <%= render 'problem' %>
</div>

<!-- -------------------------------------------------------------------- koniec -->

<div class="pane" id="finish">
  <div class="finish_content">
    <h2>Sprawdź teraz swój email.<br />
        Właśnie wysłaliśmy kupon rabatowy.<br />
        Miłych zakupów :-)</h2>
  </div>
</div>

<!-- -------------------------------------------------------------------- js -->

<script type="text/javascript">
  $(document).ready(function() {
    $(function() {
      var params = { allowScriptAccess: "always", allowFullScreen: "true", rel: 0 };
      var atts = { id: "myytplayer" };
      swfobject.embedSWF("http://www.youtube.com/e/<%=  @quiz.yt_id%>?enablejsapi=1&playerapiid=myytplayer",
                "ytapiplayer", "560", "315", "8", null, null, params, atts);
    });
  });

  function onYouTubePlayerReady(playerId) {
    ytplayer = document.getElementById(playerId);

    ytplayer.addEventListener('onStateChange', 'goToQuestions');


  }
  function goToQuestions(state) {
//    alert("fff");
    if (state == 0) {
      if(!$.cookie("ucc_<%=@quiz.id%>")){
      $.get("<%= get_questions_quiz_url(@quiz)%>", function(data) {
        $("#question_content").html(data);
      });
    }else{
      $("#question_content").html("<h2>Wykorzystano już dzisiejszą szansę.<br />Spróbuj ponownie jutro.</h2>");
    }
    $("#video.pane").hide();
    $("ul#tabs .current").removeClass("current");
    $("ul#tabs .second").addClass("current");
    $("#question.pane").show();
    }
  }


  jQuery.cookie = function (key, value, options) {

    // key and at least value given, set cookie...
    if (arguments.length > 1 && String(value) !== "[object Object]") {
      options = jQuery.extend({}, options);

      if (value === null || value === undefined) {
        options.expires = -1;
      }

      if (typeof options.expires === 'number') {
        var days = options.expires, t = options.expires = new Date();
        t.setDate(t.getDate() + days);
      }

      value = String(value);

      return (document.cookie = [
        encodeURIComponent(key), '=',
        options.raw ? value : encodeURIComponent(value),
        options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
        options.path ? '; path=' + options.path : '',
        options.domain ? '; domain=' + options.domain : '',
        options.secure ? '; secure' : ''
      ].join(''));
    }

    // key and possibly options given, get cookie...
    options = value || {};
    var result, decode = options.raw ? function (s) {
      return s;
    } : decodeURIComponent;
    return (result = new RegExp('(?:^|; )' + encodeURIComponent(key) + '=([^;]*)').exec(document.cookie)) ? decode(result[1]) : null;
  };
</script>

